<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CarSaavy — Negotiation Report Tool</title>
  <link rel="icon" type="image/png" href="/favicon.ico" />
  <style>
    /* ===== EXISTING STYLES — UNCHANGED ===== */
    :root{
      --bg:#0b0f13;
      --card:#121417;
      --muted:#9aa6b2;
      --accent1:#0077b6;
      --accent2:#00b4d8;
      --glass: rgba(255,255,255,0.03);
      --radius:14px;
    }

    header.site-header{
      position:sticky;top:0;z-index:50;
      backdrop-filter: blur(6px);
      background: linear-gradient(180deg, rgba(10,12,14,0.6), rgba(10,12,14,0.4));
      border-bottom: 1px solid rgba(255,255,255,0.03);
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 20px;
    }
    .brand{display:flex;align-items:center;gap:14px}
    .brand img{height:44px;display:block}
    nav.site-nav{display:flex;gap:14px;align-items:center}
    nav.site-nav a{
      color:var(--muted);text-decoration:none;font-weight:600;padding:8px 12px;border-radius:10px;
      transition: all .18s ease;
    }
    nav.site-nav a:hover{
      color:#fff;
      background:linear-gradient(90deg,var(--accent1),var(--accent2));
      box-shadow:0 6px 18px rgba(0,180,216,0.12);
      transform:translateY(-2px);
    }

    body {
      margin: 0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background-color: #121212;
      color: #f0f0f0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem;
    }

    h1 {
      color: #22b7f0;
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .steps {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 2rem;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    .steps.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .step {
      background: #1b2a35;
      border: 1px solid #22b7f0;
      border-radius: 12px;
      padding: 1rem 1.5rem;
      min-width: 150px;
      color: #9ed9ef;
      font-weight: 600;
      opacity: 0.7;
      transition: all 0.4s ease;
      box-shadow: 0 0 5px rgba(34, 183, 240, 0.3);
    }
    .step.active {
      opacity: 1;
      background: #22b7f0;
      color: #0c0c0c;
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(34, 183, 240, 0.8);
    }
    .step.glow {
      box-shadow: 0 0 20px rgba(34, 183, 240, 0.9);
    }

    form {
      background: #1e1e1e;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      width: 100%;
      max-width: 450px;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    form.visible {
      opacity: 1;
      transform: translateY(0);
    }

    input[type="text"],
    input[type="email"],
    select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #444;
      border-radius: 8px;
      font-size: 1rem;
      background: #2a2a2a;
      color: #f0f0f0;
      margin-bottom: 0.75rem;
    }

    button {
      width: 100%;
      margin-top: 0.25rem;
      background-color: #22b7f0;
      color: #0c0c0c;
      border: none;
      padding: 0.85rem;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s ease-in-out, transform 0.2s ease;
    }
    button:hover { background-color: #1a9dce; }

    .message {
      margin-top: 1rem;
      font-size: 0.95rem;
      color: #f87171;
      display: none;
    }

    footer {
      text-align: center;
      padding: 1rem;
      background: #1b1b1b;
      color: #9ed9ef;
    }
  </style>
</head>
<body>

<header class="site-header">
  <div class="brand">
    <a href="/"><img src="/images/carsaavy_header.webp" alt="CarSaavy logo" /></a>
  </div>
  <nav class="site-nav">
    <a href="/index">Home</a>
    <a href="/vin">VIN Tool</a>
    <a href="/about">About</a>
    <a href="/contact">Contact</a>
    <a href="/privacy">Privacy</a>
  </nav>
</header>

<main>
  <h1>Get Your Negotiation-Ready Report</h1>
  <p>Enter your VIN, or provide vehicle details if a VIN isn’t available.</p>

  <div class="steps" id="steps">
    <div class="step active">1️⃣ Vehicle Info</div>
    <div class="step">2️⃣ Pay & Process</div>
    <div class="step">3️⃣ Receive Report</div>
  </div>

  <form id="vinForm">
    <input type="email" id="email" placeholder="Enter your email" required />
    <input type="text" id="vin" placeholder="Enter your 17-character VIN (optional)" maxlength="17" />
    <input type="text" id="askingPrice" placeholder="Asking Price (optional)" />

    <p style="margin:10px 0;color:#9aa6b2;font-size:0.9rem;">
      Don’t have a VIN?
      <a href="#" id="toggleDetails" style="color:#22b7f0;text-decoration:underline;">
        Enter vehicle details instead
      </a>
    </p>

    <div id="vehicleDetails" style="display:none;">
      <input type="text" id="year" placeholder="Year (e.g. 2020)" />
      <input type="text" id="make" placeholder="Make (e.g. Toyota)" />
      <input type="text" id="model" placeholder="Model (e.g. Camry)" />

      <select id="segment">
        <option value="">Select vehicle segment</option>
        <option value="economy">Economy / Compact</option>
        <option value="sedan">Sedan</option>
        <option value="suv">SUV / Crossover</option>
        <option value="truck">Pickup Truck</option>
        <option value="performance">Performance / Sports</option>
        <option value="luxury">Luxury</option>
        <option value="hybrid">Hybrid / EV</option>
      </select>

      <select id="trimTier">
        <option value="">Select trim tier</option>
        <option value="base">Base</option>
        <option value="mid">Mid</option>
        <option value="premium">Premium</option>
        <option value="performance">Performance</option>
      </select>
    </div>

    <button type="submit">Generate Report</button>
    <div class="message" id="message"></div>
  </form>
</main>

<footer>© 2025 CarSaavy — Negotiate Smarter</footer>

<script>
  const form = document.getElementById("vinForm");
  const messageEl = document.getElementById("message");
  const toggle = document.getElementById("toggleDetails");
  const details = document.getElementById("vehicleDetails");

  toggle.addEventListener("click", e => {
    e.preventDefault();
    details.style.display = details.style.display === "none" ? "block" : "none";
  });

  function isValidVIN(v) {
    return /^[A-HJ-NPR-Z0-9]{17}$/i.test(v);
  }

  form.addEventListener("submit", async e => {
    e.preventDefault();

    const email = emailEl = document.getElementById("email").value.trim();
    const vin = document.getElementById("vin").value.trim().toUpperCase();
    const askingPrice = document.getElementById("askingPrice").value.trim();

    const year = document.getElementById("year").value.trim();
    const make = document.getElementById("make").value.trim();
    const model = document.getElementById("model").value.trim();
    const segment = document.getElementById("segment").value;
    const trimTier = document.getElementById("trimTier").value;

    const hasVin = vin && isValidVIN(vin);
    const hasDetails = year && make && model;

    if (!hasVin && !hasDetails) {
      messageEl.textContent =
        "Please enter a valid VIN or provide your vehicle details.";
      messageEl.style.display = "block";
      return;
    }

    try {
      const res = await fetch("/api/create-payment", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          email,
          vin: hasVin ? vin : null,
          year: hasDetails ? year : null,
          make: hasDetails ? make : null,
          model: hasDetails ? model : null,
          segment,
          trimTier,
          askingPrice: askingPrice || null
        })
      });

      const data = await res.json();
      if (data.url) window.location.href = data.url;
      else throw new Error("Checkout failed");
    } catch {
      messageEl.textContent = "Something went wrong. Please try again.";
      messageEl.style.display = "block";
    }
  });

  window.addEventListener("load", () => {
    document.querySelector(".steps").classList.add("visible");
    document.querySelector("form").classList.add("visible");
  });
</script>

</body>
</html>

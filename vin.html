<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CarSaavy ‚Äî VIN Report Tool</title>
  <link rel="icon" type="image/png" href="/favicon.ico" />
  <style>
    :root{
      --bg:#0b0f13;
      --card:#121417;
      --muted:#9aa6b2;
      --accent1:#0077b6;
      --accent2:#00b4d8;
      --glass: rgba(255,255,255,0.03);
      --radius:14px;
    }

    header.site-header{
      position:sticky;top:0;z-index:50;
      backdrop-filter: blur(6px);
      background: linear-gradient(180deg, rgba(10,12,14,0.6), rgba(10,12,14,0.4));
      border-bottom: 1px solid rgba(255,255,255,0.03);
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 20px;
    }
    .brand{display:flex;align-items:center;gap:14px}
    .brand img{height:44px;display:block}
    nav.site-nav{display:flex;gap:14px;align-items:center}
    nav.site-nav a{
      color:var(--muted);text-decoration:none;font-weight:600;padding:8px 12px;border-radius:10px;
      transition: all .18s ease;
    }
    nav.site-nav a:hover{
      color:#fff;
      background:linear-gradient(90deg,var(--accent1),var(--accent2));
      box-shadow:0 6px 18px rgba(0,180,216,0.12);
      transform:translateY(-2px);
    }

    body {
      margin: 0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background-color: #121212;
      color: #f0f0f0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem;
    }

    h1 {
      color: #22b7f0;
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .steps {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      margin-bottom: 2rem;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    .steps.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .step {
      background: #1b2a35;
      border: 1px solid #22b7f0;
      border-radius: 12px;
      padding: 1rem 1.5rem;
      min-width: 150px;
      color: #9ed9ef;
      font-weight: 600;
      opacity: 0.7;
      transition: all 0.4s ease;
      box-shadow: 0 0 5px rgba(34, 183, 240, 0.3);
    }
    .step.active {
      opacity: 1;
      background: #22b7f0;
      color: #0c0c0c;
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(34, 183, 240, 0.8);
    }
    .step.glow {
      box-shadow: 0 0 20px rgba(34, 183, 240, 0.9);
    }

    form {
      background: #1e1e1e;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      width: 100%;
      max-width: 450px;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    form.visible {
      opacity: 1;
      transform: translateY(0);
    }

    input[type="text"],
    input[type="email"] {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #444;
      border-radius: 8px;
      font-size: 1rem;
      background: #2a2a2a;
      color: #f0f0f0;
      margin-bottom: 0.75rem;
    }

    button {
      width: 100%;
      margin-top: 0.25rem;
      background-color: #22b7f0;
      color: #0c0c0c;
      border: none;
      padding: 0.85rem;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s ease-in-out, transform 0.2s ease;
    }
    button:hover {
      background-color: #1a9dce;
    }
    button.pulse {
      animation: pulse 0.6s ease;
    }
    @keyframes pulse {
      0% { transform: scale(1); box-shadow: 0 0 0 rgba(34, 183, 240, 0.6); }
      50% { transform: scale(1.05); box-shadow: 0 0 15px rgba(34, 183, 240, 0.9); }
      100% { transform: scale(1); box-shadow: 0 0 0 rgba(34, 183, 240, 0.6); }
    }

    .message {
      margin-top: 1rem;
      font-size: 0.95rem;
      color: #f87171;
      display: none;
    }
    .message.success {
      color: #7bf58a;
    }

    footer {
      text-align: center;
      padding: 1rem;
      background: #1b1b1b;
      color: #9ed9ef;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <a href="/"><img src="/images/carsaavy_header.webp" alt="CarSaavy logo" /></a>
    </div>

    <nav class="site-nav" aria-label="Main nav">
      <a href="/index">Home</a>
      <a href="/vin">VIN Tool</a>
      <a href="/about">About</a>
      <a href="/contact">Contact</a>
      <a href="/privacy">Privacy</a>
    </nav>
  </header>

  <main>
    <h1>Get Your Negotiation-Ready Report</h1>
    <p>Simply enter your vehicle's VIN below and follow the steps to receive your report.</p>

    <div class="steps" id="steps">
      <div class="step active" id="step1">1Ô∏è‚É£ Enter VIN</div>
      <div class="step" id="step2">2Ô∏è‚É£ Pay &amp; Process</div>
      <div class="step" id="step3">3Ô∏è‚É£ Receive Report</div>
    </div>

    <form id="vinForm">
      <!-- Email (always shown) -->
      <input type="email" id="email" placeholder="Enter your email" required />

      <!-- VIN + URL (hidden for General Report) -->
        <input type="text" id="year" placeholder="Year (e.g. 2019)" required />
        <input type="text" id="make" placeholder="Make (e.g. Toyota)" required />
        <input type="text" id="model" placeholder="Model (e.g. Camry)" required />
        <input type="text" id="trim" placeholder="Trim (optional)" />
        <input type="text" id="mileage" placeholder="Mileage (e.g. 45000)" required />
        <input type="text" id="price" placeholder="Asking Price (e.g. 18999)" required />

      <button type="submit" id="submitBtn">Generate Report</button>
      <div class="message" id="message"></div>
    </form>
  </main>

  <footer class="site-footer">
    ¬© 2025 CarSaavy ‚Äî Negotiate Smarter ‚Ä¢
    <a href="/privacy" style="color:var(--muted);text-decoration:underline">Privacy</a>
  </footer>

  <script>
    const form = document.getElementById('vinForm');
    const messageEl = document.getElementById('message');
    const steps = document.querySelector('.steps');
    const stepEls = document.querySelectorAll('.step');
    const submitBtn = document.getElementById('submitBtn');

    document.getElementById("vinForm").addEventListener("submit", async (e) => {
    e.preventDefault(); // üî¥ THIS IS THE KEY LINE

    console.log("Generate Report clicked");

    // collect inputs
    const email = document.getElementById("email").value;
    const year = document.getElementById("year").value;
    const make = document.getElementById("make").value;
    const model = document.getElementById("model").value;
    const trim = document.getElementById("trim")?.value || "";
    const mileage = document.getElementById("mileage").value;
    const price = document.getElementById("price").value;

    console.log({ email, year, make, model, trim, mileage, price });

    // call your backend
    const res = await fetch("/api/create-payment", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        email,
        year,
        make,
        model,
        trim,
        mileage,
        price
      })
    });

  const data = await res.json();

  if (data.url) {
    window.location.href = data.url;
  } else {
    alert("Failed to start checkout");
  }
});

    function isValidVIN(vin) {
      const regex = /^[A-HJ-NPR-Z0-9]{17}$/i;
      return regex.test(vin.trim());
    }

    function isValidCarsUrl(url) {
      if (!url) return false;
      try {
        const u = new URL(url.trim());
        // Must be a Cars.com vehicle detail page
        return (
          u.hostname.includes("cars.com") &&
          u.pathname.includes("/vehicledetail/")
        );
      } catch (e) {
        return false;
      }
    }

    function setStep(activeIndex) {
      stepEls.forEach((step, i) => {
        step.classList.toggle('active', i === activeIndex);
        if (i <= activeIndex) {
          step.classList.add('glow');
        } else {
          step.classList.remove('glow');
        }
      });
    }

    // Smooth entrance animations
    window.addEventListener('load', () => {
      steps.classList.add('visible');
      setTimeout(() => {
        document.querySelector('form').classList.add('visible');
      }, 400);
    });


    // Default state
    function updateVisibility() {
      if (reportGeneral.checked) {
        specifiedFields.style.display = "none";
      } else {
        specifiedFields.style.display = "block";
      }
    }

    reportGeneral.addEventListener("change", updateVisibility);
    reportSpecified.addEventListener("change", updateVisibility);
    updateVisibility();


    
  </script>

</body>
</html>
